(()=>{var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var i=e.n(t);const r=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionListItem"];var s=e.n(o);function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}const a=flarum.core.compat["common/Component"];var l=function(e){function t(){return e.apply(this,arguments)||this}var i,r;r=e,(i=t).prototype=Object.create(r.prototype),i.prototype.constructor=i,n(i,r);var o=t.prototype;return o.oninit=function(t){e.prototype.oninit.call(this,t),this.images=(this.attrs.images||[]).map(function(e){return e.replace(/\\/g,"/")}),this.currentIndex=0,this.isVisible=!1,this.loadedImages=new Set,this.autoplayTimer=null,this.outgoingTimer=null,this.observer=null,this.dom=null},o.view=function(){var e=this.attrs.sliderWidth||150,t=this.images.length;return 0===t?null:m("div",{className:"ThumbSlider ThumbSlider--loading",style:{width:e+"px"}},m("div",{className:"ThumbSlider__track"},this.images.map(function(e,t){return m("div",{className:"ThumbSlider__item"+(0===t?" ThumbSlider__item--active":""),key:t},m("img",{className:"ThumbSlider__img",alt:"",decoding:"async"}))})),t>1&&m("span",{className:"ThumbSlider__counter"},"1/",t))},o.oncreate=function(t){e.prototype.oncreate.call(this,t),this.dom=t.dom;var i=this.attrs.sliderWidth||150,r=this.dom.closest(".DiscussionListItem-content");r&&(r.style.setProperty("--thumb-slider-width",i+"px"),r.classList.add("has-ThumbSlider")),this.setupIntersectionObserver(this.dom)},o.onbeforeupdate=function(){return!1},o.onremove=function(t){e.prototype.onremove.call(this,t),this.cleanup()},o.setupIntersectionObserver=function(e){var t=this;"undefined"!=typeof IntersectionObserver?(this.observer=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting?(0===t.loadedImages.size&&t.loadFirstImage(),t.isVisible=!0,t.startAutoplay()):(t.isVisible=!1,t.stopAutoplay())})},{rootMargin:"200px 0px",threshold:.1}),this.observer.observe(e)):this.loadFirstImage()},o.loadFirstImage=function(){var e=this;if(0!==this.images.length&&this.dom){var t=this.dom.querySelector(".ThumbSlider__item");if(t){var i=t.querySelector(".ThumbSlider__img");if(i){var r=new Image;r.onload=function(){e.loadedImages.add(0),i.src=e.images[0],e.dom.classList.remove("ThumbSlider--loading"),e.images.length>1&&e.preloadImage(1)},r.onerror=function(){i.src=e.images[0],e.dom.classList.remove("ThumbSlider--loading")},r.src=this.images[0]}}}},o.preloadImage=function(e){var t=this;if(!(e>=this.images.length||this.loadedImages.has(e))){var i=new Image;i.onload=function(){t.loadedImages.add(e);var i=t.dom.querySelectorAll(".ThumbSlider__item");if(i[e]){var r=i[e].querySelector(".ThumbSlider__img");r&&(r.src=t.images[e])}},i.src=this.images[e]}},o.startAutoplay=function(){var e=this;if(!(this.autoplayTimer||this.images.length<=1)&&this.dom){var t=this.attrs.autoplaySpeed||1200;this.autoplayTimer=setInterval(function(){if(e.isVisible&&e.dom){var t=e.dom.querySelectorAll(".ThumbSlider__item");if(0!==t.length){var i=e.currentIndex;e.outgoingTimer&&(clearTimeout(e.outgoingTimer),e.outgoingTimer=null),t.forEach(function(e){return e.classList.remove("ThumbSlider__item--outgoing")}),t[i]&&(t[i].classList.remove("ThumbSlider__item--active"),t[i].classList.add("ThumbSlider__item--outgoing")),e.currentIndex=(e.currentIndex+1)%e.images.length,t[e.currentIndex]&&t[e.currentIndex].classList.add("ThumbSlider__item--active"),e.outgoingTimer=setTimeout(function(){t[i]&&t[i].classList.remove("ThumbSlider__item--outgoing"),e.outgoingTimer=null},950);var r=e.dom.querySelector(".ThumbSlider__counter");r&&(r.textContent=e.currentIndex+1+"/"+e.images.length);var o=(e.currentIndex+1)%e.images.length;e.preloadImage(o)}}else e.stopAutoplay()},t)}},o.stopAutoplay=function(){this.autoplayTimer&&(clearInterval(this.autoplayTimer),this.autoplayTimer=null)},o.cleanup=function(){this.stopAutoplay(),this.outgoingTimer&&(clearTimeout(this.outgoingTimer),this.outgoingTimer=null),this.observer&&(this.observer.disconnect(),this.observer=null),this.dom=null},t}(e.n(a)());i().initializers.add("tryhackx-thumb-sliders",function(){(0,r.extend)(s().prototype,"contentItems",function(e){if(!1!==i().forum.attribute("thumbSlidersEnabled")){var t=this.attrs.discussion.attribute("thumbImages");if(t&&Array.isArray(t)&&0!==t.length){var r=parseInt(i().forum.attribute("thumbSlidersSliderWidth"))||130,o=parseInt(i().forum.attribute("thumbSlidersAutoplaySpeed"))||1200;e.add("thumbSlider",m(l,{images:t,sliderWidth:r,autoplaySpeed:o}),110)}}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map