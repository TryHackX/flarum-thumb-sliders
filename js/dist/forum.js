(()=>{var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.reg.get("core","forum/app");var i=e.n(t);const s=flarum.reg.get("core","common/extend"),r=flarum.reg.get("core","forum/components/DiscussionListItem");var o=e.n(r);const a=flarum.reg.get("core","common/Component");var n=e.n(a);class l extends(n()){oninit(e){super.oninit(e),this.images=(this.attrs.images||[]).map(e=>e.replace(/\\/g,"/")),this.currentIndex=0,this.isVisible=!1,this.loadedImages=new Set,this.autoplayTimer=null,this.outgoingTimer=null,this.observer=null,this.dom=null}view(){const e=this.attrs.sliderWidth||150,t=this.images.length;return 0===t?null:m("div",{className:"ThumbSlider ThumbSlider--loading",style:{width:e+"px"}},m("div",{className:"ThumbSlider__track"},this.images.map((e,t)=>m("div",{className:"ThumbSlider__item"+(0===t?" ThumbSlider__item--active":""),key:t},m("img",{className:"ThumbSlider__img",alt:"",decoding:"async"})))),t>1&&m("span",{className:"ThumbSlider__counter"},"1/",t))}oncreate(e){super.oncreate(e),this.dom=e.dom;const t=this.attrs.sliderWidth||150,i=this.dom.closest(".DiscussionListItem-content");i&&(i.style.setProperty("--thumb-slider-width",t+"px"),i.classList.add("has-ThumbSlider")),this.setupIntersectionObserver(this.dom)}onbeforeupdate(){return!1}onremove(e){super.onremove(e),this.cleanup()}setupIntersectionObserver(e){"undefined"!=typeof IntersectionObserver?(this.observer=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting?(0===this.loadedImages.size&&this.loadFirstImage(),this.isVisible=!0,this.startAutoplay()):(this.isVisible=!1,this.stopAutoplay())})},{rootMargin:"200px 0px",threshold:.1}),this.observer.observe(e)):this.loadFirstImage()}loadFirstImage(){if(0===this.images.length||!this.dom)return;const e=this.dom.querySelector(".ThumbSlider__item");if(!e)return;const t=e.querySelector(".ThumbSlider__img");if(!t)return;const i=new Image;i.onload=()=>{this.loadedImages.add(0),t.src=this.images[0],this.dom.classList.remove("ThumbSlider--loading"),this.images.length>1&&this.preloadImage(1)},i.onerror=()=>{t.src=this.images[0],this.dom.classList.remove("ThumbSlider--loading")},i.src=this.images[0]}preloadImage(e){if(e>=this.images.length||this.loadedImages.has(e))return;const t=new Image;t.onload=()=>{this.loadedImages.add(e);const t=this.dom.querySelectorAll(".ThumbSlider__item");if(t[e]){const i=t[e].querySelector(".ThumbSlider__img");i&&(i.src=this.images[e])}},t.src=this.images[e]}startAutoplay(){if(this.autoplayTimer||this.images.length<=1||!this.dom)return;const e=this.attrs.autoplaySpeed||1200;this.autoplayTimer=setInterval(()=>{if(!this.isVisible||!this.dom)return void this.stopAutoplay();const e=this.dom.querySelectorAll(".ThumbSlider__item");if(0===e.length)return;const t=this.currentIndex;this.outgoingTimer&&(clearTimeout(this.outgoingTimer),this.outgoingTimer=null),e.forEach(e=>e.classList.remove("ThumbSlider__item--outgoing")),e[t]&&(e[t].classList.remove("ThumbSlider__item--active"),e[t].classList.add("ThumbSlider__item--outgoing")),this.currentIndex=(this.currentIndex+1)%this.images.length,e[this.currentIndex]&&e[this.currentIndex].classList.add("ThumbSlider__item--active"),this.outgoingTimer=setTimeout(()=>{e[t]&&e[t].classList.remove("ThumbSlider__item--outgoing"),this.outgoingTimer=null},950);const i=this.dom.querySelector(".ThumbSlider__counter");i&&(i.textContent=this.currentIndex+1+"/"+this.images.length);const s=(this.currentIndex+1)%this.images.length;this.preloadImage(s)},e)}stopAutoplay(){this.autoplayTimer&&(clearInterval(this.autoplayTimer),this.autoplayTimer=null)}cleanup(){this.stopAutoplay(),this.outgoingTimer&&(clearTimeout(this.outgoingTimer),this.outgoingTimer=null),this.observer&&(this.observer.disconnect(),this.observer=null),this.dom=null}}flarum.reg.add("tryhackx-thumb-sliders","forum/components/ThumbSlider",l),i().initializers.add("tryhackx-thumb-sliders",()=>{(0,s.extend)(o().prototype,"contentItems",function(e){if(!1===i().forum.attribute("thumbSlidersEnabled"))return;const t=this.attrs.discussion.attribute("thumbImages");if(!t||!Array.isArray(t)||0===t.length)return;const s=parseInt(i().forum.attribute("thumbSlidersSliderWidth"))||130,r=parseInt(i().forum.attribute("thumbSlidersAutoplaySpeed"))||1200;e.add("thumbSlider",m(l,{images:t,sliderWidth:s,autoplaySpeed:r}),110)})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map